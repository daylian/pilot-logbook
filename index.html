<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pilot Logbook">
    <meta name="theme-color" content="#2563EB">
    <link rel="manifest" href="manifest.json">
    <title>Pilot Logbook</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        input, select, textarea { font-size: 16px !important; }
        .app-container { min-height: 100vh; padding-bottom: env(safe-area-inset-bottom); }
        .autocomplete-item { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #e5e7eb; }
        .autocomplete-item:hover { background: #f3f4f6; }
        .install-prompt { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #2563EB; color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .install-prompt.show { display: block; }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="install-prompt" class="install-prompt">
        <span>Install Pilot Logbook for offline use!</span>
        <button onclick="installApp()" style="margin-left: 12px; background: white; color: #2563EB; border: none; padding: 6px 12px; border-radius: 4px; font-weight: bold; cursor: pointer;">Install</button>
        <button onclick="dismissInstall()" style="margin-left: 8px; background: transparent; color: white; border: 1px solid white; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Later</button>
    </div>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered: ', registration);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').classList.add('show');
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    document.getElementById('install-prompt').classList.remove('show');
                });
            }
        }

        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('show');
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Aircraft Database
        const AIRCRAFT_DB = {
            'C172': { name: 'Cessna 172', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'C152': { name: 'Cessna 152', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'C150': { name: 'Cessna 150', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'C182': { name: 'Cessna 182', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA28': { name: 'Piper Cherokee', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA-28': { name: 'Piper Cherokee', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA32': { name: 'Piper Saratoga', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA-32': { name: 'Piper Saratoga', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'SR20': { name: 'Cirrus SR20', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'SR22': { name: 'Cirrus SR22', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'DA40': { name: 'Diamond DA40', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'DA20': { name: 'Diamond DA20', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA44': { name: 'Piper Seminole', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'PA-44': { name: 'Piper Seminole', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'PA34': { name: 'Piper Seneca', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'PA-34': { name: 'Piper Seneca', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'BE58': { name: 'Baron 58', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'BE55': { name: 'Baron 55', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'C310': { name: 'Cessna 310', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'DA42': { name: 'Diamond DA42', engineType: 'Piston', engines: 'Multi', category: 'MEP' },
            'PC12': { name: 'Pilatus PC-12', engineType: 'Turboprop', engines: 'Single', category: 'SET' },
            'TBM850': { name: 'TBM 850', engineType: 'Turboprop', engines: 'Single', category: 'SET' },
            'TBM900': { name: 'TBM 900', engineType: 'Turboprop', engines: 'Single', category: 'SET' },
            'BE200': { name: 'King Air 200', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'BE300': { name: 'King Air 300', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'BE350': { name: 'King Air 350', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'DHC6': { name: 'Twin Otter', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'DHC8': { name: 'Dash 8', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'Q400': { name: 'Q400', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'ATR42': { name: 'ATR 42', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'ATR72': { name: 'ATR 72', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'SF340': { name: 'Saab 340', engineType: 'Turboprop', engines: 'Multi', category: 'MET' },
            'CRJ200': { name: 'CRJ-200', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'CRJ700': { name: 'CRJ-700', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'CRJ900': { name: 'CRJ-900', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'CRJ1000': { name: 'CRJ-1000', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'ERJ145': { name: 'ERJ-145', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'ERJ170': { name: 'E170', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'ERJ175': { name: 'E175', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E170': { name: 'E170', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E175': { name: 'E175', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E190': { name: 'E190', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E195': { name: 'E195', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E290': { name: 'E190-E2', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'E295': { name: 'E195-E2', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B737': { name: 'Boeing 737', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B738': { name: 'Boeing 737-800', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B739': { name: 'Boeing 737-900', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B37M': { name: 'Boeing 737 MAX', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B38M': { name: 'Boeing 737 MAX 8', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B39M': { name: 'Boeing 737 MAX 9', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B757': { name: 'Boeing 757', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B767': { name: 'Boeing 767', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B777': { name: 'Boeing 777', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B787': { name: 'Boeing 787', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'B747': { name: 'Boeing 747', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A320': { name: 'Airbus A320', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A319': { name: 'Airbus A319', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A321': { name: 'Airbus A321', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A318': { name: 'Airbus A318', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A330': { name: 'Airbus A330', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A340': { name: 'Airbus A340', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A350': { name: 'Airbus A350', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'A380': { name: 'Airbus A380', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'MD80': { name: 'MD-80', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'MD88': { name: 'MD-88', engineType: 'Jet', engines: 'Multi', category: 'Jet' },
            'PA18': { name: 'Piper PA-18 Super Cub', engineType: 'Piston', engines: 'Single', category: 'SEP' },
            'PA-18': { name: 'Piper PA-18 Super Cub', engineType: 'Piston', engines: 'Single', category: 'SEP' },
        };

        const lookupAircraft = (code) => {
            const upper = code.toUpperCase().trim();
            return AIRCRAFT_DB[upper] || null;
        };

        const Plane = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></svg>);
        const Save = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>);
        const Download = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);
        const Settings = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.196-13.196L15.54 7.46m-7.08 7.08-1.656 1.656M23 12h-6m-6 0H5m13.196 5.196-1.656-1.656m-7.08-7.08L7.804 6.804"/></svg>);
        const Printer = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>);

        function PilotLogbook() {
            const [flights, setFlights] = useState([]);
            const [crewMembers, setCrewMembers] = useState([]);
            const [aircraftRegistry, setAircraftRegistry] = useState([]);
            const [currentFlight, setCurrentFlight] = useState({
                date: new Date().toISOString().split('T')[0], aircraft: '', aircraftInfo: null, tailNumber: '', registration: '', from: '', to: '', out: '', off: '', on: '', in: '', flightTime: '', airTime: '', totalTime: '', pic: '', sic: '', night: '', day: '', instrument: '', dayTakeoffs: 0, nightTakeoffs: 0, dayLandings: 0, nightLandings: 0, approaches: 0, crewMember: '', role: 'First Officer', remarks: ''
            });
            const [showSettings, setShowSettings] = useState(false);
            const [useLocalTime, setUseLocalTime] = useState(false);
            const [showAutocomplete, setShowAutocomplete] = useState(false);
            const [showTailAutocomplete, setShowTailAutocomplete] = useState(false);
            const [showRegAutocomplete, setShowRegAutocomplete] = useState(false);
            const [filteredCrewMembers, setFilteredCrewMembers] = useState([]);
            const [filteredAircraft, setFilteredAircraft] = useState([]);
            const [editingFlight, setEditingFlight] = useState(null);
            const autocompleteRef = useRef(null);
            const tailAutocompleteRef = useRef(null);
            const regAutocompleteRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('pilotLogFlights');
                const savedCrew = localStorage.getItem('pilotLogCrewMembers');
                const savedAircraft = localStorage.getItem('pilotLogAircraftRegistry');
                if (saved) setFlights(JSON.parse(saved));
                if (savedCrew) setCrewMembers(JSON.parse(savedCrew));
                if (savedAircraft) setAircraftRegistry(JSON.parse(savedAircraft));
            }, []);

            useEffect(() => { localStorage.setItem('pilotLogFlights', JSON.stringify(flights)); }, [flights]);
            useEffect(() => { localStorage.setItem('pilotLogCrewMembers', JSON.stringify(crewMembers)); }, [crewMembers]);
            useEffect(() => { localStorage.setItem('pilotLogAircraftRegistry', JSON.stringify(aircraftRegistry)); }, [aircraftRegistry]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (autocompleteRef.current && !autocompleteRef.current.contains(event.target)) {
                        setShowAutocomplete(false);
                    }
                    if (tailAutocompleteRef.current && !tailAutocompleteRef.current.contains(event.target)) {
                        setShowTailAutocomplete(false);
                    }
                    if (regAutocompleteRef.current && !regAutocompleteRef.current.contains(event.target)) {
                        setShowRegAutocomplete(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const calculateTimeDiff = (start, end) => {
                if (!start || !end) return '';
                const s = new Date(`2000-01-01T${start}${useLocalTime ? '' : 'Z'}`);
                const e = new Date(`2000-01-01T${end}${useLocalTime ? '' : 'Z'}`);
                let diff = (e - s) / 3600000;
                if (diff < 0) diff += 24;
                return diff.toFixed(1);
            };

            const calculateDayNight = (offTime, onTime, airTime) => {
                if (!offTime || !onTime || !airTime) return { day: '', night: '' };
                
                const takeoffHour = parseInt(offTime.split(':')[0]);
                const landingHour = parseInt(onTime.split(':')[0]);
                
                if (takeoffHour >= 6 && takeoffHour < 18) {
                    return { day: airTime, night: '' };
                } else {
                    return { day: '', night: airTime };
                }
            };

            useEffect(() => {
                if (currentFlight.out && currentFlight.in) {
                    const flightTime = calculateTimeDiff(currentFlight.out, currentFlight.in);
                    setCurrentFlight(p => ({ 
                        ...p, 
                        flightTime: flightTime,
                        totalTime: flightTime,
                        pic: p.pic || flightTime
                    }));
                }
                if (currentFlight.off && currentFlight.on) {
                    const airTime = calculateTimeDiff(currentFlight.off, currentFlight.on);
                    const dayNight = calculateDayNight(currentFlight.off, currentFlight.on, airTime);
                    setCurrentFlight(p => ({ 
                        ...p, 
                        airTime: airTime,
                        day: p.day || dayNight.day,
                        night: p.night || dayNight.night
                    }));
                }
            }, [currentFlight.out, currentFlight.in, currentFlight.off, currentFlight.on, useLocalTime]);

            const handleAircraftChange = (value) => {
                const aircraftInfo = lookupAircraft(value);
                setCurrentFlight({
                    ...currentFlight, 
                    aircraft: value,
                    aircraftInfo: aircraftInfo
                });
            };

            const handleCrewMemberChange = (value) => {
                setCurrentFlight({...currentFlight, crewMember: value});
                if (value.length > 0) {
                    const filtered = crewMembers.filter(member => 
                        member.name.toLowerCase().includes(value.toLowerCase())
                    );
                    setFilteredCrewMembers(filtered);
                    setShowAutocomplete(filtered.length > 0);
                } else {
                    setShowAutocomplete(false);
                }
            };

            const handleTailNumberChange = (value) => {
                setCurrentFlight({...currentFlight, tailNumber: value});
                if (value.length > 0) {
                    const filtered = aircraftRegistry.filter(aircraft => 
                        aircraft.tailNumber.toLowerCase().includes(value.toLowerCase())
                    );
                    setFilteredAircraft(filtered);
                    setShowTailAutocomplete(filtered.length > 0);
                } else {
                    setShowTailAutocomplete(false);
                }
            };

            const handleRegistrationChange = (value) => {
                setCurrentFlight({...currentFlight, registration: value});
                if (value.length > 0) {
                    const filtered = aircraftRegistry.filter(aircraft => 
                        aircraft.registration.toLowerCase().includes(value.toLowerCase())
                    );
                    setFilteredAircraft(filtered);
                    setShowRegAutocomplete(filtered.length > 0);
                } else {
                    setShowRegAutocomplete(false);
                }
            };

            const selectCrewMember = (member) => {
                setCurrentFlight({...currentFlight, crewMember: member.name, role: member.role});
                setShowAutocomplete(false);
            };

            const selectAircraftByTail = (aircraft) => {
                setCurrentFlight({...currentFlight, tailNumber: aircraft.tailNumber, registration: aircraft.registration});
                setShowTailAutocomplete(false);
            };

            const selectAircraftByReg = (aircraft) => {
                setCurrentFlight({...currentFlight, tailNumber: aircraft.tailNumber, registration: aircraft.registration});
                setShowRegAutocomplete(false);
            };

            const editFlight = (flight) => {
                setCurrentFlight({...flight});
                setEditingFlight(flight.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const updateFlight = () => {
                if (!currentFlight.date || !currentFlight.aircraft) { alert('Need Date and Aircraft'); return; }
                
                if (currentFlight.crewMember && !crewMembers.find(m => m.name === currentFlight.crewMember)) {
                    setCrewMembers([...crewMembers, { name: currentFlight.crewMember, role: currentFlight.role }]);
                }

                if (currentFlight.tailNumber && currentFlight.registration && !aircraftRegistry.find(a => a.tailNumber === currentFlight.tailNumber)) {
                    setAircraftRegistry([...aircraftRegistry, { tailNumber: currentFlight.tailNumber, registration: currentFlight.registration }]);
                }

                const updatedFlights = flights.map(f => f.id === editingFlight ? {...currentFlight, id: editingFlight} : f);
                setFlights(updatedFlights);
                setCurrentFlight({ date: new Date().toISOString().split('T')[0], aircraft: '', aircraftInfo: null, tailNumber: '', registration: '', from: '', to: '', out: '', off: '', on: '', in: '', flightTime: '', airTime: '', totalTime: '', pic: '', sic: '', night: '', day: '', instrument: '', dayTakeoffs: 0, nightTakeoffs: 0, dayLandings: 0, nightLandings: 0, approaches: 0, crewMember: '', role: 'First Officer', remarks: '' });
                setEditingFlight(null);
                alert('Flight updated!');
            };

            const deleteFlight = (id) => {
                if (confirm('Delete this flight?')) {
                    setFlights(flights.filter(f => f.id !== id));
                }
            };

            const cancelEdit = () => {
                setCurrentFlight({ date: new Date().toISOString().split('T')[0], aircraft: '', aircraftInfo: null, tailNumber: '', registration: '', from: '', to: '', out: '', off: '', on: '', in: '', flightTime: '', airTime: '', totalTime: '', pic: '', sic: '', night: '', day: '', instrument: '', dayTakeoffs: 0, nightTakeoffs: 0, dayLandings: 0, nightLandings: 0, approaches: 0, crewMember: '', role: 'First Officer', remarks: '' });
                setEditingFlight(null);
            };

            const addFlight = () => {
                if (editingFlight) {
                    updateFlight();
                    return;
                }

                if (!currentFlight.date || !currentFlight.aircraft) { alert('Need Date and Aircraft'); return; }
                
                if (currentFlight.crewMember && !crewMembers.find(m => m.name === currentFlight.crewMember)) {
                    setCrewMembers([...crewMembers, { name: currentFlight.crewMember, role: currentFlight.role }]);
                }

                if (currentFlight.tailNumber && currentFlight.registration && !aircraftRegistry.find(a => a.tailNumber === currentFlight.tailNumber)) {
                    setAircraftRegistry([...aircraftRegistry, { tailNumber: currentFlight.tailNumber, registration: currentFlight.registration }]);
                }

                setFlights([{ ...currentFlight, id: Date.now(), timeZone: useLocalTime ? 'Local' : 'UTC' }, ...flights]);
                setCurrentFlight({ date: new Date().toISOString().split('T')[0], aircraft: '', aircraftInfo: null, tailNumber: '', registration: '', from: '', to: '', out: '', off: '', on: '', in: '', flightTime: '', airTime: '', totalTime: '', pic: '', sic: '', night: '', day: '', instrument: '', dayTakeoffs: 0, nightTakeoffs: 0, dayLandings: 0, nightLandings: 0, approaches: 0, crewMember: '', role: 'First Officer', remarks: '' });
                alert('Flight logged!');
            };

            const totals = flights.reduce((a, f) => {
                a.totalTime += parseFloat(f.totalTime || 0);
                a.pic += parseFloat(f.pic || 0);
                a.sic += parseFloat(f.sic || 0);
                a.day += parseFloat(f.day || 0);
                a.night += parseFloat(f.night || 0);
                a.instrument += parseFloat(f.instrument || 0);
                a.dayTakeoffs += parseInt(f.dayTakeoffs || 0);
                a.nightTakeoffs += parseInt(f.nightTakeoffs || 0);
                a.dayLandings += parseInt(f.dayLandings || 0);
                a.nightLandings += parseInt(f.nightLandings || 0);
                return a;
            }, { totalTime: 0, pic: 0, sic: 0, day: 0, night: 0, instrument: 0, dayTakeoffs: 0, nightTakeoffs: 0, dayLandings: 0, nightLandings: 0 });

            const calculateRollingTotals = () => {
                const now = new Date();
                const ninetyDaysAgo = new Date(now.getTime() - (90 * 24 * 60 * 60 * 1000));
                const sixMonthsAgo = new Date(now.getTime() - (180 * 24 * 60 * 60 * 1000));
                const oneYearAgo = new Date(now.getTime() - (365 * 24 * 60 * 60 * 1000));

                const rolling90Flights = flights.filter(f => new Date(f.date) >= ninetyDaysAgo);
                const rolling90 = rolling90Flights.reduce((sum, f) => sum + parseFloat(f.totalTime || 0), 0);
                const rolling90DayTO = rolling90Flights.reduce((sum, f) => sum + parseInt(f.dayTakeoffs || 0), 0);
                const rolling90NightTO = rolling90Flights.reduce((sum, f) => sum + parseInt(f.nightTakeoffs || 0), 0);
                const rolling90DayLdg = rolling90Flights.reduce((sum, f) => sum + parseInt(f.dayLandings || 0), 0);
                const rolling90NightLdg = rolling90Flights.reduce((sum, f) => sum + parseInt(f.nightLandings || 0), 0);
                
                const rolling180 = flights.filter(f => new Date(f.date) >= sixMonthsAgo)
                    .reduce((sum, f) => sum + parseFloat(f.totalTime || 0), 0);
                
                const rolling365 = flights.filter(f => new Date(f.date) >= oneYearAgo)
                    .reduce((sum, f) => sum + parseFloat(f.totalTime || 0), 0);

                return { 
                    rolling90, 
                    rolling90DayTO, 
                    rolling90NightTO, 
                    rolling90DayLdg, 
                    rolling90NightLdg,
                    rolling180, 
                    rolling365 
                };
            };

            const calculateCategoryTotals = () => {
                const categories = {
                    SEP: 0,
                    MEP: 0,
                    SET: 0,
                    MET: 0,
                    Jet: 0
                };
                
                flights.forEach(f => {
                    const time = parseFloat(f.totalTime || 0);
                    if (f.aircraftInfo && f.aircraftInfo.category) {
                        categories[f.aircraftInfo.category] = (categories[f.aircraftInfo.category] || 0) + time;
                    }
                });
                
                return categories;
            };

            const rollingTotals = calculateRollingTotals();
            const categoryTotals = calculateCategoryTotals();

            const exportToCSV = () => {
                const headers = ['Date','Aircraft','Type','Engine','Engines','Tail','Registration','From','To','OUT','OFF','ON','IN','Flight','Air','PIC','SIC','Day','Night','IFR','DayTO','NightTO','DayLdg','NightLdg','Appr','Crew','Role','Remarks'];
                const rows = flights.map(f => [
                    f.date,
                    f.aircraft,
                    f.aircraftInfo ? f.aircraftInfo.name : '',
                    f.aircraftInfo ? f.aircraftInfo.engineType : '',
                    f.aircraftInfo ? f.aircraftInfo.engines : '',
                    f.tailNumber,
                    f.registration,
                    f.from,
                    f.to,
                    f.out,
                    f.off,
                    f.on,
                    f.in,
                    f.flightTime,
                    f.airTime,
                    f.pic,
                    f.sic,
                    f.day,
                    f.night,
                    f.instrument,
                    f.dayTakeoffs,
                    f.nightTakeoffs,
                    f.dayLandings,
                    f.nightLandings,
                    f.approaches,
                    f.crewMember,
                    f.role,
                    f.remarks
                ]);
                const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `logbook-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const printLogbook = () => {
                const printWindow = window.open('', '_blank');
                const sortedFlights = [...flights].sort((a, b) => new Date(a.date) - new Date(b.date));
                printWindow.document.write(`<!DOCTYPE html><html><head><title>Pilot Logbook</title><style>body{font-family:Arial,sans-serif;margin:20px}.print-header{text-align:center;margin-bottom:20px;font-size:18pt;font-weight:bold}.print-table{width:100%;border-collapse:collapse;font-size:6pt}.print-table th{background:#e0e0e0;border:1px solid black;padding:3px 2px;font-weight:bold;font-size:5pt;text-align:center}.print-table td{border:1px solid black;padding:2px 1px;font-size:6pt;text-align:center}.totals-row{background:#f5f5f5;font-weight:bold}.category-row{background:#e0e7ff;font-weight:bold}</style></head><body><div class="print-header">PILOT LOGBOOK</div><table class="print-table"><thead><tr><th>Date</th><th>Aircraft</th><th>Type</th><th>Engine</th><th>Tail#</th><th>Reg</th><th>From</th><th>To</th><th>OUT</th><th>OFF</th><th>ON</th><th>IN</th><th>Flight</th><th>Air</th><th>PIC</th><th>SIC</th><th>Day</th><th>Night</th><th>IFR</th><th>Day<br/>TO</th><th>Night<br/>TO</th><th>Day<br/>Ldg</th><th>Night<br/>Ldg</th><th>Appr</th><th>Crew</th><th>Role</th><th>Remarks</th></tr></thead><tbody>${sortedFlights.map(f => `<tr><td>${f.date}</td><td>${f.aircraft}</td><td>${f.aircraftInfo ? f.aircraftInfo.name : ''}</td><td>${f.aircraftInfo ? f.aircraftInfo.engineType : ''}</td><td>${f.tailNumber}</td><td>${f.registration}</td><td>${f.from}</td><td>${f.to}</td><td>${f.out}</td><td>${f.off}</td><td>${f.on}</td><td>${f.in}</td><td>${f.flightTime}</td><td>${f.airTime}</td><td>${f.pic}</td><td>${f.sic}</td><td>${f.day}</td><td>${f.night}</td><td>${f.instrument}</td><td>${f.dayTakeoffs || 0}</td><td>${f.nightTakeoffs || 0}</td><td>${f.dayLandings}</td><td>${f.nightLandings}</td><td>${f.approaches}</td><td>${f.crewMember}</td><td>${f.role}</td><td style="text-align:left">${f.remarks}</td></tr>`).join('')}<tr class="totals-row"><td colspan="12"><strong>TOTALS</strong></td><td><strong>${totals.totalTime.toFixed(1)}</strong></td><td></td><td><strong>${totals.pic.toFixed(1)}</strong></td><td><strong>${totals.sic.toFixed(1)}</strong></td><td><strong>${totals.day.toFixed(1)}</strong></td><td><strong>${totals.night.toFixed(1)}</strong></td><td><strong>${totals.instrument.toFixed(1)}</strong></td><td><strong>${totals.dayTakeoffs}</strong></td><td><strong>${totals.nightTakeoffs}</strong></td><td><strong>${totals.dayLandings}</strong></td><td><strong>${totals.nightLandings}</strong></td><td colspan="4"></td></tr><tr class="category-row"><td colspan="12"><strong>CATEGORY TOTALS</strong></td><td colspan="3">SEP: ${categoryTotals.SEP.toFixed(1)}</td><td colspan="3">MEP: ${categoryTotals.MEP.toFixed(1)}</td><td colspan="3">Turbine: ${(categoryTotals.SET + categoryTotals.MET).toFixed(1)}</td><td colspan="6">Jet: ${categoryTotals.Jet.toFixed(1)}</td></tr></tbody></table></body></html>`);
                printWindow.document.close();
                setTimeout(() => printWindow.print(), 250);
            };

            return (
                <div className="app-container min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-20">
                    <div className="max-w-4xl mx-auto mb-6">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <Plane />
                                    <h1 className="text-2xl font-bold text-gray-800">Pilot Logbook</h1>
                                </div>
                                <button onClick={() => setShowSettings(!showSettings)} className="p-2 hover:bg-gray-100 rounded-lg">
                                    <Settings />
                                </button>
                            </div>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 p-4 bg-blue-50 rounded-lg">
                                <div><div className="text-sm text-gray-600">Total Time</div><div className="text-2xl font-bold text-black">{totals.totalTime.toFixed(1)}</div></div>
                                <div><div className="text-sm text-gray-600">PIC</div><div className="text-2xl font-bold text-black">{totals.pic.toFixed(1)}</div></div>
                                <div><div className="text-sm text-gray-600">Day/Night</div><div className="text-2xl font-bold text-black">{totals.day.toFixed(1)}/{totals.night.toFixed(1)}</div></div>
                                <div><div className="text-sm text-gray-600">Takeoffs/Ldgs</div><div className="text-2xl font-bold text-black">{totals.dayTakeoffs + totals.nightTakeoffs}/{totals.dayLandings + totals.nightLandings}</div></div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                <div className="p-3 bg-green-50 rounded-lg border border-green-200">
                                    <div className="text-xs text-green-700 font-medium">Last 90 Days</div>
                                    <div className="text-xl font-bold text-green-800">{rollingTotals.rolling90.toFixed(1)} hrs</div>
                                    <div className="text-xs text-green-600 mt-1">
                                        TO: {rollingTotals.rolling90DayTO}/{rollingTotals.rolling90NightTO} • 
                                        Ldg: {rollingTotals.rolling90DayLdg}/{rollingTotals.rolling90NightLdg}
                                    </div>
                                </div>
                                <div className="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <div className="text-xs text-yellow-700 font-medium">Last 6 Months</div>
                                    <div className="text-xl font-bold text-yellow-800">{rollingTotals.rolling180.toFixed(1)} hrs</div>
                                </div>
                                <div className="p-3 bg-purple-50 rounded-lg border border-purple-200">
                                    <div className="text-xs text-purple-700 font-medium">Last 12 Months</div>
                                    <div className="text-xl font-bold text-purple-800">{rollingTotals.rolling365.toFixed(1)} hrs</div>
                                </div>
                            </div>
                            <div className="mt-4 p-4 bg-white rounded-lg border-2 border-indigo-200">
                                <h3 className="text-sm font-bold text-indigo-800 mb-3">Flight Time by Category</h3>
                                <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                    <div className="text-center">
                                        <div className="text-xs text-gray-600">Single Piston</div>
                                        <div className="text-lg font-bold text-indigo-700">{categoryTotals.SEP.toFixed(1)}</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-xs text-gray-600">Multi Piston</div>
                                        <div className="text-lg font-bold text-indigo-700">{categoryTotals.MEP.toFixed(1)}</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-xs text-gray-600">Single Turbine</div>
                                        <div className="text-lg font-bold text-indigo-700">{categoryTotals.SET.toFixed(1)}</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-xs text-gray-600">Multi Turbine</div>
                                        <div className="text-lg font-bold text-indigo-700">{categoryTotals.MET.toFixed(1)}</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-xs text-gray-600">Jet</div>
                                        <div className="text-lg font-bold text-indigo-700">{categoryTotals.Jet.toFixed(1)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {showSettings && (
                        <div className="max-w-4xl mx-auto mb-6">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-bold mb-4">Settings</h2>
                                <div className="space-y-4">
                                    <div className="flex items-center gap-3 p-4 bg-blue-50 rounded-lg">
                                        <input 
                                            type="checkbox" 
                                            id="localTime"
                                            checked={useLocalTime}
                                            onChange={(e) => setUseLocalTime(e.target.checked)}
                                            className="w-5 h-5 text-blue-600"
                                        />
                                        <label htmlFor="localTime" className="text-sm font-medium text-gray-700">
                                            Use Local Time (instead of UTC)
                                        </label>
                                    </div>
                                    <div className="p-4 bg-gray-50 rounded-lg">
                                        <p className="text-sm text-gray-700 mb-2"><strong>Saved Crew Members:</strong></p>
                                        <div className="space-y-1">
                                            {crewMembers.length === 0 ? (
                                                <p className="text-xs text-gray-500">No crew members saved yet</p>
                                            ) : (
                                                crewMembers.map((member, i) => (
                                                    <div key={i} className="text-sm text-gray-600">
                                                        {member.name} - {member.role}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                    <div className="p-4 bg-gray-50 rounded-lg">
                                        <p className="text-sm text-gray-700 mb-2"><strong>Saved Aircraft:</strong></p>
                                        <div className="space-y-1">
                                            {aircraftRegistry.length === 0 ? (
                                                <p className="text-xs text-gray-500">No aircraft saved yet</p>
                                            ) : (
                                                aircraftRegistry.map((aircraft, i) => (
                                                    <div key={i} className="text-sm text-gray-600">
                                                        {aircraft.tailNumber} - {aircraft.registration}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                    <button onClick={() => setShowSettings(false)} className="px-4 py-2 bg-blue-600 text-white rounded-lg">Close</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto mb-6">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4">{editingFlight ? 'Edit Flight' : 'Log Flight'}</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label className="block text-sm font-medium mb-1">Date</label><input type="date" value={currentFlight.date} onChange={(e) => setCurrentFlight({...currentFlight, date: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">Aircraft</label>
                                    <input 
                                        type="text" 
                                        value={currentFlight.aircraft} 
                                        onChange={(e) => handleAircraftChange(e.target.value)} 
                                        placeholder="B737" 
                                        className="w-full px-3 py-2 border rounded-lg" 
                                    />
                                    {currentFlight.aircraftInfo && (
                                        <div className="text-xs text-green-600 mt-1">
                                            ✓ {currentFlight.aircraftInfo.name} - {currentFlight.aircraftInfo.engines} Engine {currentFlight.aircraftInfo.engineType}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="relative" ref={tailAutocompleteRef}>
                                    <label className="block text-sm font-medium mb-1">Tail Number</label>
                                    <input 
                                        type="text" 
                                        value={currentFlight.tailNumber} 
                                        onChange={(e) => handleTailNumberChange(e.target.value)}
                                        placeholder="N12345" 
                                        className="w-full px-3 py-2 border rounded-lg" 
                                    />
                                    {showTailAutocomplete && (
                                        <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1">
                                            {filteredAircraft.map((aircraft, i) => (
                                                <div 
                                                    key={i}
                                                    onClick={() => selectAircraftByTail(aircraft)}
                                                    className="autocomplete-item"
                                                >
                                                    {aircraft.tailNumber} - {aircraft.registration}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="relative" ref={regAutocompleteRef}>
                                    <label className="block text-sm font-medium mb-1">Registration</label>
                                    <input 
                                        type="text" 
                                        value={currentFlight.registration} 
                                        onChange={(e) => handleRegistrationChange(e.target.value)}
                                        placeholder="ABC123" 
                                        className="w-full px-3 py-2 border rounded-lg" 
                                    />
                                    {showRegAutocomplete && (
                                        <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1">
                                            {filteredAircraft.map((aircraft, i) => (
                                                <div 
                                                    key={i}
                                                    onClick={() => selectAircraftByReg(aircraft)}
                                                    className="autocomplete-item"
                                                >
                                                    {aircraft.registration} - {aircraft.tailNumber}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div><label className="block text-sm font-medium mb-1">From</label><input type="text" value={currentFlight.from} onChange={(e) => setCurrentFlight({...currentFlight, from: e.target.value.toUpperCase()})} placeholder="KJFK" maxLength="4" className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">To</label><input type="text" value={currentFlight.to} onChange={(e) => setCurrentFlight({...currentFlight, to: e.target.value.toUpperCase()})} placeholder="KLAX" maxLength="4" className="w-full px-3 py-2 border rounded-lg" /></div>
                                
                                <div className="relative" ref={autocompleteRef}>
                                    <label className="block text-sm font-medium mb-1">Crew Member</label>
                                    <input 
                                        type="text" 
                                        value={currentFlight.crewMember} 
                                        onChange={(e) => handleCrewMemberChange(e.target.value)}
                                        placeholder="Enter name" 
                                        className="w-full px-3 py-2 border rounded-lg" 
                                    />
                                    {showAutocomplete && (
                                        <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1">
                                            {filteredCrewMembers.map((member, i) => (
                                                <div 
                                                    key={i}
                                                    onClick={() => selectCrewMember(member)}
                                                    className="autocomplete-item"
                                                >
                                                    {member.name} - {member.role}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Role</label>
                                    <select 
                                        value={currentFlight.role} 
                                        onChange={(e) => setCurrentFlight({...currentFlight, role: e.target.value})}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    >
                                        <option value="Captain">Captain</option>
                                        <option value="First Officer">First Officer</option>
                                        <option value="Passenger">Passenger</option>
                                    </select>
                                </div>

                                <div><label className="block text-sm font-medium mb-1">OUT ({useLocalTime ? 'Local' : 'UTC'})</label><input type="time" value={currentFlight.out} onChange={(e) => setCurrentFlight({...currentFlight, out: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">OFF ({useLocalTime ? 'Local' : 'UTC'})</label><input type="time" value={currentFlight.off} onChange={(e) => setCurrentFlight({...currentFlight, off: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">ON ({useLocalTime ? 'Local' : 'UTC'})</label><input type="time" value={currentFlight.on} onChange={(e) => setCurrentFlight({...currentFlight, on: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">IN ({useLocalTime ? 'Local' : 'UTC'})</label><input type="time" value={currentFlight.in} onChange={(e) => setCurrentFlight({...currentFlight, in: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Flight Time</label><input type="number" step="0.1" value={currentFlight.flightTime} readOnly className="w-full px-3 py-2 border rounded-lg bg-gray-100" /></div>
                                <div><label className="block text-sm font-medium mb-1">Air Time</label><input type="number" step="0.1" value={currentFlight.airTime} readOnly className="w-full px-3 py-2 border rounded-lg bg-gray-100" /></div>
                                <div><label className="block text-sm font-medium mb-1">Day (hrs)</label><input type="number" step="0.1" value={currentFlight.day} onChange={(e) => setCurrentFlight({...currentFlight, day: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Night (hrs)</label><input type="number" step="0.1" value={currentFlight.night} onChange={(e) => setCurrentFlight({...currentFlight, night: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">PIC (hrs)</label><input type="number" step="0.1" value={currentFlight.pic} onChange={(e) => setCurrentFlight({...currentFlight, pic: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">SIC (hrs)</label><input type="number" step="0.1" value={currentFlight.sic} onChange={(e) => setCurrentFlight({...currentFlight, sic: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Instrument</label><input type="number" step="0.1" value={currentFlight.instrument} onChange={(e) => setCurrentFlight({...currentFlight, instrument: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Day Takeoffs</label><input type="number" value={currentFlight.dayTakeoffs} onChange={(e) => setCurrentFlight({...currentFlight, dayTakeoffs: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Night Takeoffs</label><input type="number" value={currentFlight.nightTakeoffs} onChange={(e) => setCurrentFlight({...currentFlight, nightTakeoffs: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Day Landings</label><input type="number" value={currentFlight.dayLandings} onChange={(e) => setCurrentFlight({...currentFlight, dayLandings: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Night Landings</label><input type="number" value={currentFlight.nightLandings} onChange={(e) => setCurrentFlight({...currentFlight, nightLandings: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div><label className="block text-sm font-medium mb-1">Approaches</label><input type="number" value={currentFlight.approaches} onChange={(e) => setCurrentFlight({...currentFlight, approaches: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                                <div className="md:col-span-2"><label className="block text-sm font-medium mb-1">Remarks</label><input type="text" value={currentFlight.remarks} onChange={(e) => setCurrentFlight({...currentFlight, remarks: e.target.value})} placeholder="Training, checkride, etc." className="w-full px-3 py-2 border rounded-lg" /></div>
                            </div>
                            <div className="mt-4 flex gap-2">
                                <button onClick={addFlight} className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium">
                                    <Save />{editingFlight ? 'Update Flight' : 'Log Flight'}
                                </button>
                                {editingFlight && (
                                    <button onClick={cancelEdit} className="px-6 py-3 bg-gray-400 text-white rounded-lg font-medium">
                                        Cancel
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-bold">History ({flights.length})</h2>
                                <div className="flex gap-2">
                                    <button onClick={printLogbook} disabled={flights.length === 0} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg text-sm disabled:bg-gray-300">
                                        <Printer />Print
                                    </button>
                                    <button onClick={exportToCSV} disabled={flights.length === 0} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm disabled:bg-gray-300">
                                        <Download />CSV
                                    </button>
                                </div>
                            </div>
                            {flights.length === 0 ? (
                                <p className="text-gray-500 text-center py-8">No flights logged yet</p>
                            ) : (
                                <div className="space-y-2">
                                    {flights.map((f) => (
                                        <div key={f.id} className="p-4 bg-gray-50 rounded-lg border hover:border-blue-300">
                                            <div className="font-medium text-lg">{f.date} - {f.aircraft} {f.tailNumber} ({f.registration})</div>
                                            {f.aircraftInfo && <div className="text-xs text-gray-500">{f.aircraftInfo.name} - {f.aircraftInfo.engines} Engine {f.aircraftInfo.engineType}</div>}
                                            <div className="text-gray-600 mt-1">{f.from} → {f.to}</div>
                                            {f.crewMember && <div className="text-sm text-blue-600 mt-1">Crew: {f.crewMember} ({f.role})</div>}
                                            <div className="text-sm text-gray-500 mt-1">OUT: {f.out} | OFF: {f.off} | ON: {f.on} | IN: {f.in} {f.timeZone && `(${f.timeZone})`}</div>
                                            <div className="grid grid-cols-2 md:grid-cols-5 gap-2 mt-2 text-sm">
                                                <div><span className="text-gray-500">Flight:</span> {f.flightTime}h</div>
                                                <div><span className="text-gray-500">Air:</span> {f.airTime}h</div>
                                                <div><span className="text-gray-500">PIC:</span> {f.pic}h</div>
                                                <div><span className="text-gray-500">Day/Night:</span> {f.day}/{f.night}h</div>
                                                <div><span className="text-gray-500">TO/Ldg:</span> {(f.dayTakeoffs || 0) + (f.nightTakeoffs || 0)}/{f.dayLandings}/{f.nightLandings}</div>
                                            </div>
                                            {f.remarks && <div className="mt-2 text-sm text-gray-600 italic">{f.remarks}</div>}
                                            <div className="flex gap-2 mt-3">
                                                <button onClick={() => editFlight(f)} className="flex-1 px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                                                    Edit
                                                </button>
                                                <button onClick={() => deleteFlight(f.id)} className="flex-1 px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PilotLogbook />);
    </script>
</body>
</html>
